# ğŸš€ ngrok éƒ¨ç½²æŒ‡å—

## å¿«é€Ÿå¼€å§‹

### 1. ç¯å¢ƒå‡†å¤‡

ç¡®ä¿ç³»ç»Ÿå·²å®‰è£…ï¼š
- **Docker** 20.10+
- **docker-compose** 1.29+ æˆ– Docker Compose V2

macOS ç”¨æˆ·ï¼šå®‰è£… Docker Desktop  
Linux ç”¨æˆ·ï¼š
```bash
curl -fsSL https://get.docker.com | sh
sudo systemctl start docker
```

### 2. é…ç½®ç¯å¢ƒå˜é‡

```bash
# å¤åˆ¶ç¤ºä¾‹é…ç½®
cp .env.example .env

# æ ¹æ®éœ€è¦ä¿®æ”¹é…ç½®
vim .env
```

### 3. ä¸€é”®éƒ¨ç½²

```bash
# èµ‹äºˆæ‰§è¡Œæƒé™
chmod +x deploy.sh

# å¯åŠ¨æ‰€æœ‰æœåŠ¡
./deploy.sh up
```

## ğŸ“– å‘½ä»¤å‚è€ƒ

### åŸºç¡€å‘½ä»¤

| å‘½ä»¤ | è¯´æ˜ | ç¤ºä¾‹ |
|------|------|------|
| `up` | å¯åŠ¨æ‰€æœ‰æœåŠ¡ | `./deploy.sh up` |
| `down` | åœæ­¢æ‰€æœ‰æœåŠ¡ | `./deploy.sh down` |
| `restart` | é‡å¯æœåŠ¡ | `./deploy.sh restart` |
| `logs` | æŸ¥çœ‹æ—¥å¿— | `./deploy.sh logs ngrokd` |
| `ps` | æŸ¥çœ‹å®¹å™¨çŠ¶æ€ | `./deploy.sh ps` |
| `exec` | è¿›å…¥å®¹å™¨ | `./deploy.sh exec ngrokd sh` |
| `clean` | æ¸…ç†æ‰€æœ‰èµ„æº | `./deploy.sh clean` |

### é€‰é¡¹å‚æ•°

| å‚æ•° | è¯´æ˜ | ç¤ºä¾‹ |
|------|------|------|
| `-e, --env` | æŒ‡å®šç¯å¢ƒ | `./deploy.sh --env=prod up` |
| `-d, --debug` | è°ƒè¯•æ¨¡å¼ | `./deploy.sh --debug up` |
| `-q, --quiet` | é™é»˜æ¨¡å¼ | `./deploy.sh --quiet up` |
| `-n, --dry-run` | æ¨¡æ‹Ÿæ‰§è¡Œ | `./deploy.sh --dry-run up` |
| `-h, --help` | å¸®åŠ©ä¿¡æ¯ | `./deploy.sh --help` |

## ğŸ”§ ä½¿ç”¨åœºæ™¯

### åœºæ™¯ 1: æœ¬åœ°å¼€å‘

```bash
# é…ç½®æœ¬åœ°åŸŸåè§£æ
echo "127.0.0.1 ngrok.local" | sudo tee -a /etc/hosts

# å¯åŠ¨æœåŠ¡
./deploy.sh up

# è®¿é—® Web ç•Œé¢
open http://ngrok.local:8080
```

### åœºæ™¯ 2: ç”Ÿäº§éƒ¨ç½²

```bash
# åˆ‡æ¢åˆ°ç”Ÿäº§ç¯å¢ƒé…ç½®
./deploy.sh --env=prod up

# åå°è¿è¡Œå¹¶æŸ¥çœ‹æ—¥å¿—
./deploy.sh logs -f ngrokd
```

### åœºæ™¯ 3: è°ƒè¯•é—®é¢˜

```bash
# å¯ç”¨è°ƒè¯•æ¨¡å¼
./deploy.sh --debug up

# è¿›å…¥å®¹å™¨æ’æŸ¥
./deploy.sh exec ngrokd sh

# æŸ¥çœ‹è¯¦ç»†æ—¥å¿—
cat deploy.log
```

### åœºæ™¯ 4: å¤šç¯å¢ƒç®¡ç†

```bash
# å¼€å‘ç¯å¢ƒ
./deploy.sh --env=dev up

# æµ‹è¯•ç¯å¢ƒ
./deploy.sh --env=staging up

# ç”Ÿäº§ç¯å¢ƒ
./deploy.sh --env=prod up
```

## ğŸ¯ æ ¸å¿ƒç‰¹æ€§

### âœ… ç¯å¢ƒè‡ªæ„ˆä¸æ ¡éªŒ
- è‡ªåŠ¨æ£€æµ‹ Dockerã€docker-compose ä¾èµ–
- è‡ªåŠ¨ç”Ÿæˆé»˜è®¤ `.env` é…ç½®æ–‡ä»¶
- ç‰ˆæœ¬å…¼å®¹æ€§æ£€æŸ¥ï¼ˆDocker 20.10+ï¼‰

### ğŸ¨ å¯è§†åŒ–åé¦ˆ
- **é¢œè‰²ç¼–ç **ï¼šæˆåŠŸï¼ˆç»¿è‰²ï¼‰ã€è­¦å‘Šï¼ˆé»„è‰²ï¼‰ã€é”™è¯¯ï¼ˆçº¢è‰²ï¼‰
- **åŠ è½½åŠ¨ç”»**ï¼šæ„å»ºé•œåƒæ—¶çš„ Spinner æ•ˆæœ
- **è¿›åº¦æ¡**ï¼šå¥åº·æ£€æŸ¥çš„å®æ—¶è¿›åº¦æ˜¾ç¤º

### ğŸ›¡ï¸ é²æ£’æ€§ä¿éšœ
- **åŸå­æ“ä½œ**ï¼šæ„å»ºå¤±è´¥ä¸å½±å“è¿è¡Œä¸­çš„å®¹å™¨
- **ä¿¡å·å¤„ç†**ï¼šCtrl+C ä¼˜é›…é€€å‡ºå¹¶æ¸…ç†ä¸´æ—¶æ–‡ä»¶
- **è¿›ç¨‹é”**ï¼šé˜²æ­¢å¹¶å‘æ‰§è¡Œå¯¼è‡´çš„å†²çª

### ğŸ” è°ƒè¯•å‹å¥½
- `--debug` æ¨¡å¼è¾“å‡ºè¯¦ç»†æ—¥å¿—
- å¤±è´¥æ—¶è‡ªåŠ¨å±•ç¤ºæœ€è¿‘ 20 è¡Œå®¹å™¨æ—¥å¿—
- æŒä¹…åŒ–æ—¥å¿—æ–‡ä»¶ `deploy.log`

## ğŸ“ æ–‡ä»¶ç»“æ„

```
ngrok/
â”œâ”€â”€ deploy.sh              # ä¸»éƒ¨ç½²è„šæœ¬
â”œâ”€â”€ Dockerfile             # æœåŠ¡ç«¯é•œåƒ
â”œâ”€â”€ Dockerfile.client      # å®¢æˆ·ç«¯é•œåƒ
â”œâ”€â”€ docker-compose.yml     # å®¹å™¨ç¼–æ’é…ç½®
â”œâ”€â”€ .env                   # ç¯å¢ƒå˜é‡ï¼ˆéœ€è‡ªè¡Œåˆ›å»ºï¼‰
â”œâ”€â”€ .env.example           # ç¯å¢ƒå˜é‡ç¤ºä¾‹
â”œâ”€â”€ .dockerignore          # Docker æ„å»ºå¿½ç•¥æ–‡ä»¶
â”œâ”€â”€ config/
â”‚   â””â”€â”€ ngrok-client.yml   # å®¢æˆ·ç«¯é…ç½®ç¤ºä¾‹
â””â”€â”€ DEPLOY.md              # æœ¬æ–‡æ¡£
```

## ğŸ”’ å®‰å…¨æœ€ä½³å®è·µ

1. **ç”Ÿäº§ç¯å¢ƒ**: ä¿®æ”¹é»˜è®¤ç«¯å£å’ŒåŸŸå
2. **æ•æ„Ÿä¿¡æ¯**: ä¸è¦å°† `.env` æäº¤åˆ° Git
3. **TLS è¯ä¹¦**: ä½¿ç”¨çœŸå®è¯ä¹¦æ›¿æ¢è‡ªç­¾åè¯ä¹¦
4. **é˜²ç«å¢™**: é™åˆ¶å…¬å…±ç«¯å£çš„è®¿é—®æ¥æº

## ğŸ› å¸¸è§é—®é¢˜

### Q: Docker å®ˆæŠ¤è¿›ç¨‹æœªè¿è¡Œ
A: 
```bash
# macOS
å¯åŠ¨ Docker Desktop

# Linux
sudo systemctl start docker
```

### Q: ç«¯å£è¢«å ç”¨
A: ä¿®æ”¹ `.env` ä¸­çš„ç«¯å£é…ç½®ï¼š
```bash
NGROK_HTTP_PORT=9090
NGROK_HTTPS_PORT=9443
```

### Q: é•œåƒæ„å»ºå¤±è´¥
A:
```bash
# æŸ¥çœ‹è¯¦ç»†æ—¥å¿—
./deploy.sh --debug up

# æ¸…ç†ç¼“å­˜é‡æ–°æ„å»º
docker system prune -a
./deploy.sh up
```

### Q: å®¹å™¨å¯åŠ¨å¤±è´¥
A:
```bash
# æŸ¥çœ‹å®¹å™¨æ—¥å¿—
./deploy.sh logs ngrokd

# æ£€æŸ¥å®¹å™¨çŠ¶æ€
docker ps -a

# è¿›å…¥å®¹å™¨æ’æŸ¥
./deploy.sh exec ngrokd sh
```

## ğŸ“Š æ€§èƒ½ä¼˜åŒ–

### é•œåƒæ„å»ºåŠ é€Ÿ
```bash
# å¯ç”¨ BuildKit
export DOCKER_BUILDKIT=1

# ä½¿ç”¨å¤šé˜¶æ®µæ„å»ºç¼“å­˜
docker-compose build --parallel
```

### æ—¥å¿—ç®¡ç†
```bash
# é™åˆ¶æ—¥å¿—å¤§å°ï¼ˆdocker-compose.ymlï¼‰
logging:
  driver: "json-file"
  options:
    max-size: "10m"
    max-file: "3"
```

## ğŸ”„ æ›´æ–°æµç¨‹

```bash
# 1. æ‹‰å–æœ€æ–°ä»£ç 
git pull origin main

# 2. é‡æ–°æ„å»ºé•œåƒ
./deploy.sh down
docker-compose build --no-cache

# 3. å¯åŠ¨æ–°ç‰ˆæœ¬
./deploy.sh up
```

## ğŸ“ è·å–å¸®åŠ©

- **è„šæœ¬å¸®åŠ©**: `./deploy.sh --help`
- **é¡¹ç›®æ–‡æ¡£**: æŸ¥çœ‹ `CLAUDE.md`
- **æ—¥å¿—æ–‡ä»¶**: `tail -f deploy.log`

---

**æç¤º**: é¦–æ¬¡è¿è¡Œæ—¶ï¼Œé•œåƒæ„å»ºå¯èƒ½éœ€è¦ 5-10 åˆ†é’Ÿï¼Œè¯·è€å¿ƒç­‰å¾…ã€‚
